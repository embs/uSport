<%= content_for :load_javascript_after_application do %>
  <%= subscribe_to new_user_channel_match_move_path(@match.channel.owner, @match.channel, @match) %>
<% end %>

<% content_for :top_of_content do %>
  <div class="well">
    <table class='table'>
      <thead>
        <tr>
          <th colspan="12">
            <h1>
              <%= image_tag(@match.channel.avatar(:thumb), class: 'img-polaroid img-rounded') %>
              <%= @match.channel.name %>
            </h1>
          </th>
        </tr>
      </thead>
    <% if can? :create, @move %>
      <tbody>
        <tr class='hidden-tablet hidden-phone'>
          <td>
            <%#FIXME Pensar num jeito de refatorar esse .each %>
            <% ['punt', 'extrapoint', 'penalty', 'kickoff', 'fumble', 'tackle',
              'therun', 'turnover', 'time', 'touchdown', 'fieldgoal', 'thepass'].each do |kind| %>
              <div class='dropdown' style='float: left; padding: 5px;'>
                <%= link_to '#', :class => 'dropdown-toggle', :'data-toggle' => 'dropdown' do %>
                  <%= image_tag("icons/#{kind}.png", class: 'img-circle img-polaroid',
                    style: 'width: 80px; height: 80px') %>
                <% end %>
                <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
                  <li>
                    <div style='padding: 15px;'>
                      <%#TODO Transformar formulário abaixo em uma partial %>
                      <h3><%= kind.capitalize %>!</h3>
                      <%= form_for Move.new, url: { action: 'create'}, :html => {:autocomplete => "off"}, remote: 'true' do |f| %>
                        Time
                        <%= f.select :team,
                          options_for_select(@match.teams.collect { |t| [t.name, t.id] }) %>
                        Jogador
                        <% value = "##{@move.player.number} #{@move.player.first_name}" if @move.player %>
                        <%= f.text_field :player, class: 'typeahead player', autocomplete:'off', value: value %>
                        Comentário
                        <%= f.text_area :description, :cols => "30", :rows =>"8", :style => "resize: none;" %>
                        <%= f.submit :class => "btn" %>
                      <% end %>
                    </div>
                  </li>
                </ul>
              </div>
            <% end %>
          </td>
        </tr>
        <tr class='hidden-desktop'>
          <td>
            <%= render :partial => 'new_move' %>
          </td>
        </tr>
      </tbody>
    <% end %>
    </table>
    <%#FIXME Tableless? Que é que é isso? %>
    <table class="table well" style="margin-bottom: 0px">
      <tbody>
        <tr>
          <td width="30%" style="text-align: right">
            <h3><%= @match.teams[0].name %></h3>
          </td>
          <td width= "10%" style="text-align: right">
            <%= image_tag @match.teams[0].avatar(:thumb), style: "width: 60px; max-width:60px;" %>
          </td>
          <td width="20%" height='100%'  style="text-align: center">
            <h1 style="line-height: 100%; height: 100%; white-space: nowrap"><%= @match.value1.to_s + " X " + @match.value2.to_s%></h1>
          </td>
          <td width= "10%" style="text-align: left">
            <%= image_tag @match.teams[1].avatar(:thumb), style: "width: 60px; max-width:60px;" %>
          </td>
          <td width="30%" style="text-align: left">
            <h3><%= @match.teams[1].name %></h3>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
<% end %>

<% content_for :left_side_bar do %>
  <div class='thumbnail well'>
    <h4>Partidas</h4>
    <ul class="nav nav-list">
      <% @match.channel.matches.each do |m| %>
        <li><%= link_to m.name, match_path(m) %></li>
      <% end %>
    </ul>
  </div>
<% end %>

<% if @moves.empty? %> <%# Mensagens para quando a partida não possui jogadas %>
  <div class='alert alert-info'>
    <% if @match.date <= Time.now # transmissão já deveria ter começado %>
      A partida já deveria ter começado mas ainda nenhum lance foi adicionado. Talvez
      <%= @match.channel.owner.first_name %>, o dono do canal, esteja atrasado.
    <% else %>
      <strong>Oi, <%= current_user.try(:first_name) || 'torcedor(a)' %></strong>.
      Que bom que você veio acompanhar esta partida! Ela está programada para começar
      <%= l @match.date, format: :short %>h. Mas fique ligado! Novos lances podem
      surgir mesmo antes do início da partida.
    <% end %>
  </div>
<% else %> <%# Lance a Lance, exibido quando há ao menos uma jogada %>
  <div class="well">
    <table class="table table-striped">
      <thead>
        <tr>
          <th colspan="2">Lance a Lance</th>
        </tr>
      </thead>
      <tbody id='moves'>
        <%= render partial: 'moves/move', collection: @moves,
          locals: { show_comment_button: 'true' } %>
      </tbody>
    </table>
    <%= link_to_unless(@moves.last_page?, "Mostrar mais...",
      moves_path(@match,
      page: (@moves.current_page+1)), rel: 'next', remote: true, class: 'btn',
      id: 'show-more', style: 'margin: auto;') do |name| %>
      <%= name = '' %> <%# # passa um bloco que apaga o 'Mostrar mais...' %>
    <% end %>
  </div>
<% end %>
